# Sección 04: Explora patrones de integración empresarial de Apache Camel

---

## Explora patrones pipeline y multicast en Camel

Los patrones `pipeline()` y `multicast()` en `Apache Camel` se utilizan para procesar mensajes en rutas,
permitiendo manipular y transformar datos de forma estructurada y eficiente.

### Pipeline

El patrón `pipeline()` en `Apache Camel` permite procesar un mensaje de manera secuencial a través de múltiples etapas.
Cada etapa recibe el mensaje resultante de la etapa anterior, lo procesa y lo pasa a la siguiente etapa. Este patrón es
útil cuando deseas aplicar una serie de transformaciones o manipulaciones consecutivas a un mensaje, ya que asegura un
procesamiento en cadena.

`Pipeline` simplemente es una secuencia de pasos y es el valor predeterminado. Este es un patrón por defecto que se
admite en `Camel`. Por ejemplo, podríamos haber colocado luego del `from()` el `pipeline()`, pero como viene por
defecto, ya no es necesario colocarlo.

````java

@Override
public void configure() throws Exception {
    from("file:files/input")
            //.pipeline()
            // otros métodos
            .to("file:files/output");
}
````

Este patrón es adecuado para operaciones que dependen de los cambios de las etapas previas.

### Multicast

El patrón `multicast()` permite enviar el mismo mensaje a múltiples rutas en paralelo o de manera secuencial,
permitiendo procesar el mensaje en varias direcciones o etapas a la vez. A diferencia de `pipeline()`, el mensaje
original no se modifica para cada ruta individual, y cada ruta recibe una copia idéntica. Este patrón es útil para
casos donde deseas realizar varias operaciones independientes sobre el mismo mensaje sin que una afecte a las demás.

Con `multicast` podemos escribir múltiples endpoints, es decir, podemos enviar un mismo mensaje hacia afuera a cualquier
número de endpoints usando `multicast()`.

````java

@Component
public class EipPatternsRoute extends RouteBuilder {
    @Override
    public void configure() throws Exception {
        from("timer:multicast?period=10000")
                .multicast()
                .to("log:registro-01", "log:registro-02", "log:registro-03");
    }
}
````

- Con `multicast()`, el mensaje se envía a estos tres destinos simultáneamente. Los destinos son componentes `log`, que
  imprimen el mensaje en el registro de `Camel` con los identificadores `registro-01`, `registro-02` y `registro-03`.
  Cada uno de estos destinos recibe una copia idéntica del mensaje generado por el temporizador.
- Las rutas procesan el mensaje original independientemente.
- Es útil para dividir el mensaje en tareas independientes y combinar los resultados al final si es necesario.

Si ejecutamos la aplicación para ver el comportamiento de la configuración anterior, veremos el siguiente resultado
en consola.

````bash
INFO 9204 --- [camel-microservice-a] [           main] d.m.app.CamelMicroserviceAApplication    : Starting CamelMicroserviceAApplication using Java 21.0.1 with PID 9204 (M:\PERSONAL\PROGRAMACION\DESARROLLO_JAVA_SPRING\01.udemy\04.in28Minutes_Official\apache-camel-projects\camel-microservice-a\target\classes started by USUARIO in M:\PERSONAL\PROGRAMACION\DESARROLLO_JAVA_SPRING\01.udemy\04.in28Minutes_Official\apache-camel-projects)
INFO 9204 --- [camel-microservice-a] [           main] d.m.app.CamelMicroserviceAApplication    : No active profile set, falling back to 1 default profile: "default"
INFO 9204 --- [camel-microservice-a] [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
INFO 9204 --- [camel-microservice-a] [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
INFO 9204 --- [camel-microservice-a] [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.31]
INFO 9204 --- [camel-microservice-a] [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
INFO 9204 --- [camel-microservice-a] [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 4121 ms
INFO 9204 --- [camel-microservice-a] [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 1 endpoint beneath base path '/actuator'
INFO 9204 --- [camel-microservice-a] [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
INFO 9204 --- [camel-microservice-a] [           main] o.a.c.impl.engine.AbstractCamelContext   : Apache Camel 4.8.1 (camel-1) is starting
INFO 9204 --- [camel-microservice-a] [           main] o.a.c.impl.engine.AbstractCamelContext   : Routes startup (total:1)
INFO 9204 --- [camel-microservice-a] [           main] o.a.c.impl.engine.AbstractCamelContext   :     Started route1 (timer://multicast)
INFO 9204 --- [camel-microservice-a] [           main] o.a.c.impl.engine.AbstractCamelContext   : Apache Camel 4.8.1 (camel-1) started in 148ms (build:0ms init:0ms start:148ms)
INFO 9204 --- [camel-microservice-a] [           main] d.m.app.CamelMicroserviceAApplication    : Started CamelMicroserviceAApplication in 9.364 seconds (process running for 10.6)
INFO 9204 --- [camel-microservice-a] [mer://multicast] registro-01                              : Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
INFO 9204 --- [camel-microservice-a] [mer://multicast] registro-02                              : Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
INFO 9204 --- [camel-microservice-a] [mer://multicast] registro-03                              : Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
````

## Diferencias clave entre pipeline y multicast

- `Pipeline`: Procesa el mensaje en secuencia, cada etapa modifica el mensaje para la siguiente.
- `Multicast`: Duplica el mensaje y lo envía a múltiples rutas, usualmente en paralelo, y cada ruta trabaja de forma
  independiente sobre el mensaje original.